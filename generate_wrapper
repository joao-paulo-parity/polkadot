#!/bin/bash

echo "#!/bin/bash

set -eu

echo \"BEFORE \$@\" >> /tmp/args.txt

args=()

for arg in \"\$@\"; do
  case \"\$arg\" in
    -Bsymbolic|-symbolic|-Bdynamic|-dynamic|-shared*|-nodefaultlibs|-nostartfiles) continue ;;
    *.so|*.so.*) echo \"Detected dynamic object: \$@\" > /tmp/log2.txt; exit 1;;
  esac

  args+=(\"\$arg\")
done

echo \"AFTER \${args[@]}\" >> /tmp/args.txt

$1 \"\${args[@]}\"
"
